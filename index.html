<!doctype html>
<html lang="en">
  <head>
    <title>Chart.js example</title>
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
      #dot {
        height: 25px;
        width: 25px;
        background-color: red;
        border-radius: 50%;
        display: inline-block;
      }
      #main {
        margin-left: 10%;
        margin-right: 10%;
        border-left: 1px solid gray;
        border-right: 1px solid gray;
        padding-left: 10px;
        padding-right: 10px;
      }
    </style>
  </head>
  <body>
    

    <script type="module" src="main.js"></script>

    <div id="main">
      <div style="text-align: center;">
        <h2><i>Loudness Detection Threshold</i></h2>
      </div>
      <div class="chart-container" style="position: relative; width: 60vw; margin-left: auto; margin-right: auto;">
        <canvas id="graph"></canvas>
      </div>
      <button id="start">Start</button>
      <div>
        <div>
          Did you hear the tone?
        </div>
        <button id="yes">Yes</button>
        <button type="button" id="no">No</button>
      </div>
      <div>
        <div>
          Sound: 
        </div>
        <span id="dot"></span>
      </div>
      <div style="display: inline-flex; flex-direction: row; justify-content: space-between;">
        <details>
          <summary>Thresholds table</summary>
          <table>
            <thead>
              <th>Frequency (Hz)</th>
              <th>Loudness (dBFS)</th>
            </thead>
            <tbody id="table_body">
              <!-- <tr>
                <td>0</td>
                <td>0</td>
              </tr> -->
            </tbody>
          </table>
        </details>
        <div style="width: 72%;">
          <i>dBFS</i> - deciBels relative to full scale. Any sound emitting device cannot produce sounds greater than its hardware allows. Therefore, it is impossible to determine the deciBels without an audio detector. Thus, one way to determine the loudness generated by a computer is to define its maximum amplitude as one.
          In general, one signal is 80dB relative to something else. The reference point we usually use to measure sounds in the physical world is the Sound Pressure Level, or dB SPL. Its reference sound is a very quiet one: The lower threshold of human hearing, or, "roughly the sound of a mosquito flying 3 m away". So effectively, when we want to talk about loudness in decibels, we always compare it to the sound that mosquito at the other end of the room is making.
          All we can really do in Web Audio is measure wave amplitudes and let the user's audio system determine how loud they actually end up being. But what we can do is define how loud our sounds are relative to each other. For this purpose, a useful decibel measurement for us is Decibels relative to full scale (dBFS), which is anchored on the maximum peak level possible in the system.
          <p>There's a exponential relationship that relates to loudness: When we make a sound a certain amount of decibels louder, the underlying sound wave's peak amplitude grows exponentially.</p>
          <p>The specific formula for the decibel level of a sound wave is</p>
          <p>The <code>a</code> here is the amplitude of the wave and <code>a</code><sub><code>0</code></sub> is the amplitude of the <em>reference wave</em> - the sound we are anchoring to. In dB SPL (the mosquito three meters away) <code>a</code><sub><code>0</code></sub> is <code>0.00002</code>, and in dBFS (which we commonly use in Web Audio) it is <code>1</code>. In the latter case the formula conveniently simplifies to</p>
          <p><code>d = 20 * log</code><sub><code>10</code></sub><code>(a)</code>.</p>
          <p>We can also flip the formula around, so that if we know the desired decibel level (dBFS), we can get the corresponding amplitude from that:</p>
          <p><code>a = 10</code><sup><code>d/20</code></sup></p>
          <p>What these formulas are saying is that as we increase the decibel level <code>d</code>, the sound wave amplitude grows very quickly, by a factor of <code>10</code><sup><code>d</code></sup>. Or, conversely, as we increase the amplitude, the decibel level grows more slowly than that. We need a large change in amplitude to get an audible difference in the sound level.</p>
        </div>
      </div>
    </div>
  </body>
</html>
